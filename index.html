<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>–ó–∞—è–≤–∫–∞ –Ω–∞ —Ä–µ–º–æ–Ω—Ç ‚Äî –û–û–û ¬´–°–ï–†–í–ò–°–¢–†–ê–ù–°–ê–í–¢–û¬ª</title>
  <style>
    :root {
      --text: #333;
      --border: #ccc;
      --bg: #fff;
      --primary: #007bff;
      --danger: #dc3545;
    }
    * { box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
      background: #f8f9fa;
      padding: 10px;
      margin: 0;
      font-size: 14px;
      line-height: 1.5;
    }
    .container {
      max-width: 960px;
      margin: 0 auto;
      background: var(--bg);
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    h2, h3 {
      text-align: center;
      margin: 16px 0 12px;
      color: var(--text);
      font-size: 18px;
    }
    .header-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 20px;
      font-size: 13px;
      line-height: 1.4;
    }
    .form-row {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      margin: 12px 0;
    }
    .form-group {
      flex: 1;
      min-width: 200px;
    }
    .form-group label {
      display: block;
      font-weight: 600;
      margin-bottom: 4px;
      color: #444;
    }
    .form-group input, .form-group select {
      width: 100%;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 12px 0;
      font-size: 13px;
    }
    th, td {
      text-align: left;
      padding: 8px 6px;
      border-bottom: 1px solid var(--border);
    }
    thead th {
      font-weight: 600;
      background: #f8f9fa;
    }
    .btn {
      padding: 8px 16px;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 15px;
      font-weight: bold;
      margin: 5px;
    }
    .btn-save { background: #28a745; }
    .btn-sm { padding: 4px 8px; font-size: 12px; }
    .btn-delete { background: var(--danger); padding: 2px 6px; font-size: 12px; }
    .no-print {
      display: block;
      text-align: center;
      margin-top: 20px;
    }
    @media print {
      .no-print { display: none !important; }
    }
  </style>
</head>
<body>

<div class="container">
  <div class="header-row">
    <div>
      –ü–û–°–¢–ê–í–©–ò–ö: –û–±—â–µ—Å—Ç–≤–æ —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–π –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å—é "–°–ï–†–í–ò–°–¢–†–ê–ù–°–ê–í–¢–û"<br>
      –ò–ù–ù 7723905004, –ö–ü–ü 772101001<br>
      111674, –≥. –ú–æ—Å–∫–≤–∞, –≤–Ω.—Ç–µ—Ä.–≥. –º—É–Ω–∏—Ü–∏–ø–∞–ª—å–Ω—ã–π –æ–∫—Ä—É–≥ –ù–µ–∫—Ä–∞—Å–æ–≤–∫–∞, –ø—Ä-–∫—Ç –ó–∞—â–∏—Ç–Ω–∏–∫–æ–≤ –ú–æ—Å–∫–≤—ã<br>
      —Ç–µ–ª.: +7 (929) 774-88-66, –ö–æ–¥ –ø–æ –û–ö–ü–û 29289257
    </div>
    <div><strong>–î–∞—Ç–∞:</strong> <span id="current-date">‚Äî</span></div>
  </div>

  <h2>–§–æ—Ä–º–∞ –∑–∞—è–≤–∫–∏</h2>

  <div class="form-row">
    <div class="form-group">
      <label>–ù–æ–º–µ—Ä –Ω–∞—Ä—è–¥–∞</label>
      <input type="text" id="order-number" readonly>
    </div>
  </div>

  <div class="form-row">
    <div class="form-group">
      <label>–ö–æ–º–ø–∞–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞</label>
      <input type="text" id="client-company" placeholder="–û–û–û / –ò–ü / –§–ò–û –∫–ª–∏–µ–Ω—Ç–∞">
    </div>
    <div class="form-group">
      <label>–ö–æ–Ω—Ç–∞–∫—Ç</label>
      <input type="text" id="client-contact" placeholder="–ö–æ–Ω—Ç–∞–∫—Ç–Ω–æ–µ –ª–∏—Ü–æ / —Ç–µ–ª–µ—Ñ–æ–Ω">
    </div>
  </div>

  <div class="form-row">
    <div class="form-group">
      <label>–ú–∞—Å—Ç–µ—Ä</label>
      <input type="text" id="master-name" placeholder="–ò–≤–∞–Ω–æ–≤ –ò.–ò.">
    </div>
    <div class="form-group">
      <label>–°–æ—Ç—Ä—É–¥–Ω–∏–∫ –≤—ã–µ–∑–¥–∞</label>
      <input type="text" id="field-agent" placeholder="–ü–µ—Ç—Ä–æ–≤ –ü.–ü.">
    </div>
    <div class="form-group">
      <label>–ú–∞—Ä–∫–∞</label>
      <input type="text" id="vehicle-brand" placeholder="–ì–ê–ó–µ–ª—å, Ford Transit...">
    </div>
    <div class="form-group">
      <label>–ì–æ—Å. –Ω–æ–º–µ—Ä</label>
      <input type="text" id="license-plate" placeholder="–ê111–í–í77">
    </div>
    <div class="form-group">
      <label>–¢–µ–ª–µ—Ñ–æ–Ω</label>
      <input type="text" id="client-phone" placeholder="89123456789">
    </div>
    <div class="form-group">
      <label>–ü—Ä–æ–±–µ–≥ (–∫–º)</label>
      <input type="number" id="mileage" placeholder="123456">
    </div>
  </div>

  <h3>–ó–∞—è–≤–ª–µ–Ω–Ω—ã–µ —Ä–∞–±–æ—Ç—ã</h3>
  <div class="form-row">
    <input type="text" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ" id="work-desc1" style="flex:2;">
    <input type="number" placeholder="–ö–æ–ª-–≤–æ" id="work-qty1" value="1" min="1" style="width:80px;">
    <select id="work-side1" style="width:100px;"><option>‚Äî</option><option>–õ–µ–≤–∞—è</option><option>–ü—Ä–∞–≤–∞—è</option></select>
    <select id="work-pos1" style="width:100px;"><option>‚Äî</option><option>–í–µ—Ä—Ö</option><option>–ù–∏–∑</option></select>
    <button class="btn-sm" onclick="addWorkRow('planned')">+ –î–æ–±–∞–≤–∏—Ç—å</button>
  </div>
  <table id="planned-table">
    <thead><tr><th>‚Ññ</th><th>–û–ø–∏—Å–∞–Ω–∏–µ</th><th>–ö–æ–ª-–≤–æ</th><th>–°—Ç–æ—Ä–æ–Ω–∞</th><th>–ü–æ–ª–æ–∂–µ–Ω–∏–µ</th><th></th></tr></thead>
    <tbody></tbody>
  </table>

  <h3>–í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ —Ä–∞–±–æ—Ç—ã</h3>
  <div class="form-row">
    <input type="text" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ" id="work-desc2" style="flex:2;">
    <input type="number" placeholder="–ö–æ–ª-–≤–æ" id="work-qty2" value="1" min="1" style="width:80px;">
    <select id="work-side2" style="width:100px;"><option>‚Äî</option><option>–õ–µ–≤–∞—è</option><option>–ü—Ä–∞–≤–∞—è</option></select>
    <select id="work-pos2" style="width:100px;"><option>‚Äî</option><option>–í–µ—Ä—Ö</option><option>–ù–∏–∑</option></select>
    <input type="number" placeholder="–¶–µ–Ω–∞" id="work-price2" style="width:100px;">
    <button class="btn-sm" onclick="addWorkRow('actual')">+ –î–æ–±–∞–≤–∏—Ç—å</button>
  </div>
  <table id="actual-table">
    <thead><tr><th>‚Ññ</th><th>–û–ø–∏—Å–∞–Ω–∏–µ</th><th>–ö–æ–ª-–≤–æ</th><th>–°—Ç–æ—Ä–æ–Ω–∞</th><th>–ü–æ–ª–æ–∂–µ–Ω–∏–µ</th><th>–¶–µ–Ω–∞</th><th>–°—É–º–º–∞</th><th></th></tr></thead>
    <tbody></tbody>
  </table>

  <h3>–ó–∞–ø—á–∞—Å—Ç–∏</h3>
  <div class="form-row">
    <input type="text" placeholder="–ê—Ä—Ç–∏–∫—É–ª" id="part-art" style="width:120px;">
    <input type="text" placeholder="–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ" id="part-name" style="flex:2;">
    <input type="number" placeholder="–ö–æ–ª-–≤–æ" id="part-qty" value="1" min="1" style="width:80px;">
    <input type="number" placeholder="–¶–µ–Ω–∞" id="part-price" style="width:100px;">
    <button class="btn-sm" onclick="addPartRow()">+ –î–æ–±–∞–≤–∏—Ç—å</button>
  </div>
  <table id="parts-table">
    <thead><tr><th>‚Ññ</th><th>–ê—Ä—Ç–∏–∫—É–ª</th><th>–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ</th><th>–ö–æ–ª-–≤–æ</th><th>–¶–µ–Ω–∞</th><th>–°—É–º–º–∞</th><th></th></tr></thead>
    <tbody></tbody>
  </table>

  <div class="totals">
    <div>–ò—Ç–æ–≥–æ —Ä–∞–±–æ—Ç: <span id="total-works">0</span> ‚ÇΩ</div>
    <div>–ò—Ç–æ–≥–æ –∑–∞–ø—á–∞—Å—Ç–µ–π: <span id="total-parts">0</span> ‚ÇΩ</div>
    <div>–û–±—â–∞—è —Å—É–º–º–∞: <span id="grand-total">0</span> ‚ÇΩ</div>
  </div>

  <div class="no-print">
    <button class="btn btn-save" onclick="saveClaim()">‚úÖ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    <button class="btn" onclick="exportTo1C()">üì§ –≠–∫—Å–ø–æ—Ä—Ç –≤ CSV –¥–ª—è 1–°</button>
    <button class="btn" onclick="showClaimPreview()">üìÑ –†–∞—Å–ø–µ—á–∞—Ç–∞—Ç—å –∑–∞—è–≤–∫—É</button>
    <button class="btn" style="background:#28a745;" onclick="showOrderPreview()">üñ®Ô∏è –†–∞—Å–ø–µ—á–∞—Ç–∞—Ç—å –∑–∞–∫–∞–∑-–Ω–∞—Ä—è–¥</button>
  </div>
</div>

<!-- –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –ü–ï–ß–ê–¢–ò (–æ—Å—Ç–∞–≤–∏–º –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏) -->
<div class="preview-modal" id="preview-modal" style="display:none;">
  <div class="preview-content" id="preview-content"></div>
</div>

<script>
  let workIndex = 1, actualIndex = 1, partIndex = 1;

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
  (() => {
    const now = new Date();
    const d = `${String(now.getDate()).padStart(2, '0')}.${String(now.getMonth() + 1).padStart(2, '0')}.${now.getFullYear()}`;
    document.getElementById('current-date').textContent = d;
    document.getElementById('order-number').value = `–°–¢–ê-${now.getFullYear()}-${String(Date.now() % 1000).padStart(3, '0')}`;
  })();

  // === –†–ê–ë–û–¢–ê –° –¢–ê–ë–õ–ò–¶–ê–ú–ò (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ===
  function addWorkRow(type) {
    const isPlanned = type === 'planned';
    const desc = (isPlanned ? document.getElementById('work-desc1') : document.getElementById('work-desc2')).value || '‚Äî';
    const qty = (isPlanned ? document.getElementById('work-qty1') : document.getElementById('work-qty2')).value || 1;
    const side = (isPlanned ? document.getElementById('work-side1') : document.getElementById('work-side2')).value || '‚Äî';
    const pos = (isPlanned ? document.getElementById('work-pos1') : document.getElementById('work-pos2')).value || '‚Äî';
    const price = isPlanned ? null : parseFloat(document.getElementById('work-price2').value) || 0;
    const total = isPlanned ? null : qty * price;
    const tbody = document.querySelector(`#${type}-table tbody`);
    const row = tbody.insertRow();
    const idx = isPlanned ? workIndex++ : actualIndex++;

    const cells = [
      { t: idx },
      { t: desc },
      { t: qty },
      { t: side },
      { t: pos },
      ...(isPlanned ? [] : [{ t: price }, { t: total }]),
      { h: `<button class="btn-delete" onclick="removeRow(this)">‚úï</button>` }
    ];
    cells.forEach(c => {
      const td = document.createElement('td');
      td[c.h ? 'innerHTML' : 'textContent'] = c.t || c.h;
      row.appendChild(td);
    });
    recalc();
  }

  function addPartRow() {
    const art = document.getElementById('part-art').value || '‚Äî';
    const name = document.getElementById('part-name').value || '‚Äî';
    const qty = document.getElementById('part-qty').value || 1;
    const price = parseFloat(document.getElementById('part-price').value) || 0;
    const total = qty * price;
    const tbody = document.querySelector('#parts-table tbody');
    const row = tbody.insertRow();
    const idx = partIndex++;
    const cells = [
      { t: idx }, { t: art }, { t: name }, { t: qty }, { t: price }, { t: total },
      { h: `<button class="btn-delete" onclick="removeRow(this)">‚úï</button>` }
    ];
    cells.forEach(c => {
      const td = document.createElement('td');
      td[c.h ? 'innerHTML' : 'textContent'] = c.t || c.h;
      row.appendChild(td);
    });
    recalc();
  }

  function removeRow(btn) { btn.closest('tr').remove(); recalc(); }

  function recalc() {
    let w = 0, p = 0;
    document.querySelectorAll('#actual-table tbody tr').forEach(r => w += parseFloat(r.cells[6]?.textContent) || 0);
    document.querySelectorAll('#parts-table tbody tr').forEach(r => p += parseFloat(r.cells[5]?.textContent) || 0);
    const g = w + p;
    document.getElementById('total-works').textContent = w;
    document.getElementById('total-parts').textContent = p;
    document.getElementById('grand-total').textContent = g;
  }

  function saveClaim() {
    alert('‚úÖ –ó–∞—è–≤–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –≤ –ø–∞–º—è—Ç–∏ –ø–ª–∞–Ω—à–µ—Ç–∞.\n–î–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –≤ 1–° –∏—Å–ø–æ–ª—å–∑—É–π –∫–Ω–æ–ø–∫—É ¬´–≠–∫—Å–ø–æ—Ä—Ç –≤ CSV –¥–ª—è 1–°¬ª.');
  }

  // === –≠–ö–°–ü–û–†–¢ –í CSV –î–õ–Ø 1–° ===
  function exportTo1C() {
    const order = document.getElementById('order-number').value;
    const date = document.getElementById('current-date').textContent;
    const company = document.getElementById('client-company').value || '';
    const contact = document.getElementById('client-contact').value || '';
    const master = document.getElementById('master-name').value || '';
    const agent = document.getElementById('field-agent').value || '';
    const brand = document.getElementById('vehicle-brand').value || '';
    const plate = document.getElementById('license-plate').value || '';
    const phone = document.getElementById('client-phone').value || '';
    const mileage = document.getElementById('mileage').value || '';

    // === –§–æ—Ä–º–∏—Ä—É–µ–º —Å—Ç—Ä–æ–∫–∏ ===
    let lines = [];

    // –ó–∞—è–≤–ª–µ–Ω–Ω—ã–µ
    document.querySelectorAll('#planned-table tbody tr').forEach(row => {
      lines.push([
        order, date, company, contact, master, agent, brand, plate, phone, mileage,
        '–ó–∞—è–≤–ª–µ–Ω–Ω–∞—è', 
        row.cells[1].textContent, 
        row.cells[2].textContent, 
        row.cells[3].textContent, 
        row.cells[4].textContent,
        '', '', '' // –∞—Ä—Ç–∏–∫—É–ª, —Ü–µ–Ω–∞, —Å—É–º–º–∞ ‚Äî –ø—É—Å—Ç–æ
      ]);
    });

    // –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ
    document.querySelectorAll('#actual-table tbody tr').forEach(row => {
      lines.push([
        order, date, company, contact, master, agent, brand, plate, phone, mileage,
        '–í—ã–ø–æ–ª–Ω–µ–Ω–Ω–∞—è', 
        row.cells[1].textContent, 
        row.cells[2].textContent, 
        row.cells[3].textContent, 
        row.cells[4].textContent,
        '', 
        row.cells[5].textContent, 
        row.cells[6].textContent
      ]);
    });

    // –ó–∞–ø—á–∞—Å—Ç–∏
    document.querySelectorAll('#parts-table tbody tr').forEach(row => {
      lines.push([
        order, date, company, contact, master, agent, brand, plate, phone, mileage,
        '–ó–∞–ø—á–∞—Å—Ç—å', 
        row.cells[2].textContent, // –ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ
        row.cells[3].textContent, // –ö–æ–ª-–≤–æ
        '', '', // —Å—Ç–æ—Ä–æ–Ω–∞, –ø–æ–ª–æ–∂–µ–Ω–∏–µ ‚Äî –ø—É—Å—Ç–æ
        row.cells[1].textContent, // –ê—Ä—Ç–∏–∫—É–ª
        row.cells[4].textContent, // –¶–µ–Ω–∞
        row.cells[5].textContent  // –°—É–º–º–∞
      ]);
    });

    // === CSV-–∑–∞–≥–æ–ª–æ–≤–æ–∫ ===
    const header = [
      '–ù–æ–º–µ—Ä –Ω–∞—Ä—è–¥–∞', '–î–∞—Ç–∞', '–ö–æ–º–ø–∞–Ω–∏—è', '–ö–æ–Ω—Ç–∞–∫—Ç', '–ú–∞—Å—Ç–µ—Ä', '–°–æ—Ç—Ä—É–¥–Ω–∏–∫ –≤—ã–µ–∑–¥–∞',
      '–ú–∞—Ä–∫–∞', '–ì–æ—Å. –Ω–æ–º–µ—Ä', '–¢–µ–ª–µ—Ñ–æ–Ω', '–ü—Ä–æ–±–µ–≥ (–∫–º)',
      '–¢–∏–ø —Å—Ç—Ä–æ–∫–∏', '–û–ø–∏—Å–∞–Ω–∏–µ/–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ', '–ö–æ–ª-–≤–æ', '–°—Ç–æ—Ä–æ–Ω–∞', '–ü–æ–ª–æ–∂–µ–Ω–∏–µ', '–ê—Ä—Ç–∏–∫—É–ª', '–¶–µ–Ω–∞', '–°—É–º–º–∞'
    ];

    // === –°–æ–±–∏—Ä–∞–µ–º CSV ===
    let csv = header.map(cell => `"${cell.replace(/"/g, '""')}"`).join(';') + '\n';
    lines.forEach(line => {
      csv += line.map(cell => `"${(cell || '').toString().replace(/"/g, '""')}"`).join(';') + '\n';
    });

    // === –°–∫–∞—á–∏–≤–∞–µ–º —Å BOM –¥–ª—è UTF-8 ===
    const bom = '\uFEFF';
    const blob = new Blob([bom + csv], { type: 'text/csv;charset=utf-8;' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `zayavka_1c_${order}.csv`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
  }

  // === –ü–µ—á–∞—Ç—å (–æ—Å—Ç–∞–≤–∏–º, –Ω–æ –±–µ–∑ QR) ===
  function showClaimPreview() {
    alert('–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á—ë–Ω. –ò—Å–ø–æ–ª—å–∑—É–π —ç–∫—Å–ø–æ—Ä—Ç –≤ CSV ‚Üí –∑–∞–≥—Ä—É–∑–∏ –≤ 1–° ‚Üí –ø–µ—á–∞—Ç—å –∏–∑ 1–°.');
  }
  function showOrderPreview() {
    alert('–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á—ë–Ω. –ò—Å–ø–æ–ª—å–∑—É–π —ç–∫—Å–ø–æ—Ä—Ç –≤ CSV ‚Üí –∑–∞–≥—Ä—É–∑–∏ –≤ 1–° ‚Üí –ø–µ—á–∞—Ç—å –∏–∑ 1–°.');
  }
</script>

</body>
</html>
